# 微信公众号发布完整指南

## 功能说明

现在脚本已经实现了完整的微信公众号发布功能：

1. ✅ **自动上传封面图** - 自动查找并上传封面图
2. ✅ **Markdown转HTML** - 将Markdown转换为微信公众号格式
3. ✅ **图片自动上传** - 文章中的图片自动上传到微信服务器
4. ✅ **发布到素材库** - 文章发布到微信公众号素材库，可在后台预览和群发

## 使用步骤

### 1. 准备封面图（可选但推荐）

在以下位置放置封面图，脚本会自动查找：

- `content/文章目录/cover.jpg` 或 `cover.png`
- `content/images/文章名.jpg` 或 `文章名.png`
- `content/images/cover.jpg` 或 `cover.png`

**封面图要求**：
- 格式：JPG或PNG
- 大小：建议小于1MB
- 尺寸：建议900x500像素（比例16:9）

### 2. 预览文章（推荐先预览）

```bash
# 预览单篇文章
python3 scripts/publish_to_wechat.py content/后端架构/第一章-单机苦修·草根启程.md

# 预览所有新文章
./scripts/publish_new_articles.sh
```

预览模式会显示：
- 文章标题
- 摘要
- 内容长度
- 不会实际上传或发布

### 3. 实际发布

```bash
# 发布单篇文章
python3 scripts/publish_to_wechat.py content/后端架构/第一章-单机苦修·草根启程.md --publish

# 发布所有新文章
./scripts/publish_new_articles.sh --publish
```

发布流程：
1. 查找封面图并上传
2. 转换Markdown为HTML
3. 上传文章中的图片
4. 发布到微信公众号素材库

### 4. 在微信公众平台操作

发布成功后，文章会出现在：
- **素材管理 -> 图文消息**

你可以：
- 预览文章效果
- 编辑文章内容
- 群发给粉丝
- 定时群发

## 封面图处理

### 如果没有封面图

脚本会提示：
```
⚠️  未找到封面图，将使用默认封面
提示: 在文章目录或content/images/目录放置cover.jpg或cover.png作为封面图
是否继续发布（无封面图）? (y/N):
```

选择：
- `y` - 继续发布（无封面图）
- `N` - 取消发布，添加封面图后重试

### 封面图上传失败

如果封面图上传失败，脚本会：
- 显示错误信息
- 询问是否继续无封面发布
- 可以选择跳过封面图继续发布

## 常见问题

### Q: 发布后在哪里找到文章？

A: 登录微信公众平台 -> 素材管理 -> 图文消息，找到刚发布的文章。

### Q: 可以自动群发吗？

A: 当前版本发布到素材库，需要手动在后台群发。自动群发需要额外的API权限。

### Q: 文章中的图片会自动上传吗？

A: 是的，脚本会自动检测文章中的图片并上传到微信服务器。

### Q: 如何设置原文链接？

A: 当前版本原文链接为空，可以在发布后手动编辑，或修改脚本添加博客URL。

### Q: 可以发布多图文消息吗？

A: 当前版本支持单图文，多图文需要修改代码或手动在后台组合。

## 错误处理

脚本包含完善的错误处理：

- **IP白名单错误** (40164) - 提示配置IP白名单
- **AppID/Secret错误** (40013/40125) - 提示检查配置
- **封面图错误** (40007) - 提示检查封面图
- **内容格式错误** (40008) - 提示检查文章内容

## 下一步优化

- [ ] 支持设置原文链接
- [ ] 支持自动群发
- [ ] 支持多图文消息
- [ ] 支持草稿箱功能
- [ ] 支持定时发布

